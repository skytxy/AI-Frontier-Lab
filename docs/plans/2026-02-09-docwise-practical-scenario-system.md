# Docwise 实操场景系统设计

**Date**: 2026-02-09
**Status**: Draft
**Type**: Feature Design

## 背景与问题

当前 Docwise 的问题是：

1. **场景不透明**：用户说 "complex"，但 Docwise 实际执行什么，用户看不到
2. **验证脱离实际**：Learner 只检查文档逻辑/链接，没有按文档执行实操
3. **场景定义僵化**：场景是预先写死的，不能根据章节性质动态生成
4. **初学者无认知**：用户连技术是什么都不知道，怎么确认场景？

**核心问题**：Docwise 需要从"文档审查工具"转变为"实操验证系统"。

## 设计目标

1. **场景透明化**：用户清楚知道 Docwise 要做什么
2. **实战验证**：Learner 按文档执行实际操作，验证文档可操作性
3. **动态生成**：场景基于章节性质、网络实践、用户需求动态生成
4. **用户友好**：提供技术概览，让初学者能理解要验证什么

## 核心概念

### 场景 vs 文档的关系

```
场景 = 验证手段（用这个场景来测试文档是否完善）
     ≠ 文档范围（文档不能只写这个场景）

文档 = 通识性内容（覆盖该技术的完整知识体系）
     + 适当广度和深度（根据复杂度调整）
     ≠ 围绕单一场景的实验记录
```

### 文档状态约定

| 状态 | 含义 | 使用场景 |
|------|------|---------|
| `draft` | 草稿，早期阶段 | 刚创建，内容不完整 |
| `in-progress` | 开发中，有实质内容 | 主要章节已有内容 |
| `published` | 已发布，内容稳定 | 可对外展示，可小幅迭代 |
| `completed` | 里程碑完成，不再改动 | 某版本的文档冻结，存档用 |

**概览判断逻辑**：
- `draft` / `in-progress` → 不充分，需搜索补充
- `published` / `completed` → 充分，从文档提取

**重要**: `completed` 状态的文档在执行 `:improve`/`:check` 时，**必须显式提示用户**：
```
⚠️  该文档状态为 "completed"（里程碑冻结）
   执行 improve/check 将会更改文档状态和内容

   确认继续? [Y/n]
```

**原则**: `:improve`/`:check` 的目的是**完善现有文档**，不是生成全新文档。除非用户明确提出"重写"类需求。

## 系统流程

### 整体流程图

```
┌─────────────────────────────────────────────────────────────┐
│  用户输入                                                     │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  概览阶段                                                     │
│  ├─ :new      → WebSearch 最新信息                           │
│  ├─ :check   → 读文档 status                                 │
│  │                   ├─ draft/in-progress → 搜索补充          │
│  │                   └─ published/completed → 直接使用        │
│  └─ :improve → 读文档 + 显示当前概况 + 缺口                   │
│                                                              │
│  显示: 【是什么】【有什么用】                                  │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  场景生成阶段                                                 │
│  ├─ 分析章节性质 (Agent/Algo)                                │
│  ├─ WebSearch 搜索实践                                       │
│  ├─ 生成场景 + 核心议题                                       │
│  └─ 用户确认/调整                                            │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  场景确认阶段                                                 │
│  显示: 场景描述、核心议题、协作方式、学习成果、执行说明         │
│  用户: [Y/n/修改场景/调整议题]                                │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  Learner 执行阶段                                             │
│  ├─ 按文档执行实操                                            │
│  ├─ 记录: 哪些清晰、哪些卡住                                  │
│  └─ 报告缺口 + 建议下次验证的议题                             │
└─────────────────────────────────────────────────────────────┘
```

### 子命令详细流程

#### :new 流程

```
用户: /docwise:new "mcp server"
    ↓
WebSearch: MCP 是什么、应用场景
    ↓
显示概览:
  【是什么】MCP 是开放协议，让 AI 连接外部工具
  【有什么用】代码助手、数据分析、企业集成...
    ↓
分析章节性质 → WebSearch 实践 → 生成场景
    ↓
显示场景确认:
  场景描述、核心议题、协作方式、学习成果、执行说明
    ↓
用户确认
    ↓
开始生成文档
```

#### :check 流程

```
用户: /docwise:check "mcp, complex"
    ↓
读取文档:
  • 检查 status (draft/in-progress → 需搜索补充)
  • 提取概览信息
  • 生成/读取文档摘要
    ↓
显示概览:
  【是什么】(来自文档或搜索)
  【有什么用】(来自文档或搜索)
  【文档状态】draft / in-progress / published / completed
    ↓
文档摘要 + WebSearch → 场景设计
    ↓
显示场景确认
    ↓
用户确认
    ↓
Learner 执行验证:
  • 按文档执行实操
  • 记录议题覆盖情况
  • 报告缺口 + 建议下次验证的议题
```

#### :improve 流程

```
用户: /docwise:improve "mcp, 补充进度通知"
    ↓
读取文档:
  • 提取概览
  • 分析当前覆盖
  • 识别缺口
    ↓
显示概览:
  【是什么】(来自文档)
  【有什么用】(来自文档)
  【当前概况】已覆盖: stdio, tools, resources
              缺口: progress, subscriptions
  【改进目标】补充进度通知机制
    ↓
聚焦缺口 + WebSearch → 场景设计
    ↓
显示场景确认
    ↓
执行改进
```

## 场景生成逻辑

### 核心议题来源

| 子命令 | 文档完成度 | 核心议题来源 |
|--------|-----------|-------------|
| `:new` | 无文档 | WebSearch 搜索结果 |
| `:improve` | 有文档（可能不完整） | 文档内容 + WebSearch 补充 |
| `:check` | 有文档 | WebSearch 搜索结果（用于比对内容覆盖度） |

**说明**：
- `:check` 是"体检"，需要基于搜索结果来审视文档内容覆盖度是否充分
- `:improve` 是"完善"，议题应聚焦于文档缺口和需要补充的部分

### 搜索策略

| 情况 | 搜索关键词 | 目标 |
|------|-----------|------|
| 用户明确场景 | "mcp server progress notification implementation" | 围绕实操场景细化 |
| 用户未明确场景 | "mcp server tutorial examples best practices" | 兼顾实操 + 教育意义 |

### 复杂度映射

| 复杂度 | 文档要求 | 场景验证范围 |
|-------|---------|-------------|
| **simple** | 基础用法 + 核心概念 | 验证基础功能可实现 |
| **medium** | 全面覆盖常用特性 | 验证中等复杂度功能 |
| **complex** | 深度 + 边缘情况 + 专家技巧 | 验证高级功能，处理边界情况 |

### 章节性质分析

**Agent 章节**：
- 分析: 技术框架、协议、工具集
- 议题提取: 通信机制、API 设计、使用模式、最佳实践

**Algo 章节**：
- 分析: 算法/模型论文
- 议题提取: 技术脉络、核心思想、数学推导、实现要点、对比验证

## 输出格式

### 概览输出

```
📋 技术概览
─────────────────────────────────
【是什么】
一句话定义 + 通俗解释

【有什么用】
典型应用场景（2-4个）
```

### 场景确认输出

```
🎯 实操场景确认
─────────────────────────────────
章节: [章节名称]

【场景描述 - 你要做什么】
详细的场景描述，让初学者能理解要做什么

为什么选这个场景?
说明这个场景的代表性

【核心议题 - 重点学习什么】
1. 议题一: 说明
2. 议题二: 说明
...

【协作方式 - Agent 如何帮你】
Learner Agent: ...
Author Agent: (如有问题) ...
Reviewer Agent: ...

【你将获得 - 学习成果】
✓ 产物一
✓ 产物二
...

【执行说明 - 代码放哪里】
代码生成在: [路径]
目录不会被覆盖，你可以随时回来查看

─────────────────────────────────
这个场景 OK 吗？[Y/n/修改场景/调整议题]
```

### Learner 执行报告

```
【Learner 执行报告】
✓ 完成场景: [场景描述]

✓ 议题覆盖验证:
  ✓ 议题一 - 文档清晰，可完成
  ✓ 议题二 - 文档清晰，可完成
  ⚠ 议题三 - 文档提到但步骤不清，卡在...
  ✗ 议题四 - 文档未覆盖，无法完成

【发现的文档缺口】
  • 议题三: 具体缺失描述
  • 议题四: 具体缺失描述

【建议】
  这些缺口是否应该在场景中？如果应该，下次 check 可以加入验证
```

### Learner 产物结构

Learner 执行后在 `sandbox/XXX/` 下生成用户友好的产物：

```
.docwise/sandbox/001/
  ├── README.md              # 产物总览（必选）
  ├── learning-log.md        # 学习笔记（必选）
  ├── code/                  # 生成代码
  │   ├── server.ts
  │   └── ...
  └── validation/            # 验证结果
      └── output.log
```

**README.md 模板**：

```markdown
# Docwise 实操验证产物

## 基本信息

- **章节**: agent/mcp-deep-dive
- **场景ID**: 001
- **执行时间**: 2026-02-09
- **复杂度**: medium

## 场景描述

[用户确认的场景描述]

## 核心议题

1. [议题一]
2. [议题二]
...

## 目标

[本次验证要达成的目标]

## 工作流

1. [步骤一]
2. [步骤二]
...

## 发现的问题

### 议题覆盖验证

| 议题 | 状态 | 说明 |
|------|------|------|
| 议题一 | ✓ | 文档清晰，可完成 |
| 议题二 | ⚠ | 文档提到但步骤不清 |
| 议题三 | ✗ | 文档未覆盖 |

### 文档缺口

- [缺口一描述]
- [缺口二描述]

### 执行过程中的卡点

- [卡点一]
- [卡点二]

## 改进建议

- [建议一]
- [建议二]

## 代码产物

- `code/server.ts` - [描述]
- `code/...` - [描述]

## 验证结果

- [验证结果描述]
```

## 防护机制

### 1. 缺口优先级过滤

```
优先级定义:
  • critical: 场景无法完成 → 必须修复
  • important: 理解困难但可勉强完成 → 建议修复
  • minor: 文字润色、可读性提升 → 默认跳过

规则:
  - 默认只修复 critical + important
  - minor 让用户手动选择是否修复
```

### 2. 变更范围确认

```
预计变更:
  ✏️  [文件1]: +行数
  ✏️  [文件2]: +行数

总计: +行数

确认执行? [Y/n/只修复 critical]
```

## 文档约束（Paradigm 更新）

### 场景与文档关系原则

```
场景设计原则:
  • 从文档出发：场景应能被文档中的知识支撑
  • 跨章节验证：一个好场景会涉及文档的多个章节
  • 可操作检验：Learner 能否按文档完成场景

文档设计原则:
  • 场景无关：文档不因某个场景而改变范围
  • 知识驱动：以技术本身的体系为纲
  • 读者友好：不过度堆砌，保持可读性

避免:
  ❌ 为凑"完整性"而塞入边缘内容
  ❌ 围绕单个场景写文档（其他都不提）
  ❌ 变成实验记录或代码仓库说明
```

### 文档内容原则

| 类型 | 要求 |
|------|------|
| **Agent 章节** | 覆盖核心概念、常用模式、最佳实践、常见陷阱 |
| **Algo 章节** | 覆盖核心思想、数学原理、实现要点、对比验证 |

## 实现要点

### 1. 临时目录结构

```
agent/mcp-deep-dive/
  .docwise/
    sandbox/
      001-exec-validate-progress/   # 带标识符的目录名
      002-improve-resource-support/
      ...
    cache/
      mcp-deep-dive-summary.yaml    # 文档摘要缓存
```

**目录命名规则**：`<序号>-<简短描述>`，便于识别执行内容

**概览缓存**：不需要单独缓存，概览信息应已存在于文档目录中（如 README.md 的概述部分）

### 2. Learner 执行权限

- Learner 在 `.docwise/sandbox/xxx/` 下有完整读写权限
- 可以运行验证命令（如 `npm test`, `python script.py`）
- 生成的代码不会被下次执行覆盖

### 3. 学习产物

每次执行必须生成用户友好的产物，包含：
- `README.md` - 产物总览（议题、场景、目标、工作流、发现、改进）
- `learning-log.md` - Learner 的学习笔记
- `code/` - 可运行的代码参考（如果有）
- `validation/` - 验证结果记录

### 4. Learner 验证场景的依据

- **优先级 1**：topic 本身场景设计（章节类型、核心议题）
- **优先级 2**：用户指定的场景/复杂度
- Learner 需要按照场景设计的核心议题来验证文档覆盖度

### 2. Learner 执行权限

- Learner 在 `.docwise/sandbox/xxx/` 下有完整读写权限
- 可以运行验证命令（如 `npm test`, `python script.py`）
- 生成的代码不会被下次执行覆盖

### 3. 学习产物

每次执行必须生成用户友好的产物，包含：
- `README.md` - 产物总览（议题、场景、目标、工作流、发现、改进）
- `learning-log.md` - Learner 的学习笔记
- `code/` - 可运行的代码参考（如果有）
- `validation/` - 验证结果记录

## 待决问题

1. **验证命令**：Learner 执行时用什么命令验证？用户指定还是自动推断？

## 相关文档

- `.docwise/paradigm.md` - 项目级方法论
- `.claude/skills/docwise/` - Docwise 技能实现
